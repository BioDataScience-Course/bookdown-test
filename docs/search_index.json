[
["variance2.html", "Module 11 Variance II", " Module 11 Variance II Objectifs Maîtriser les différentes variantes d’ANOVA à deux facteurs Distinguer dans quel cas utiliser l’une ou l’autre de ces variantes Comprendre différents types de syntaxe dans R Prérequis Ce module présente la suite de l’ANOVA initiée au module 10. Vous devez avoir bien compris l’ANOVA à un facteur avant d’entamer le présent chapitre. "],
["anova-a-deux-facteurs.html", "11.1 ANOVA à deux facteurs", " 11.1 ANOVA à deux facteurs Dans le cadre de l’ANOVA à un facteur, nous avions une variable réponse numérique étudiée pour différents niveaux d’une seule variable facteur à j niveaux ou modalités. Le modèle utilisé était : \\[y_{ij} = \\mu + \\tau_j + \\epsilon_i \\mathrm{\\ avec\\ } \\epsilon \\sim N(0, \\sigma)\\] Les \\(\\tau_j\\) représent les variations entre la moyenne générale \\(µ\\) et les moyennes respectives des \\(j\\) sous-populations. En R, nous avons utilisé la formule suivante : \\[y \\sim fact\\] avec \\(y\\) la variable numérique réponse et \\(fact\\) la variable facteur explicative unique. Si nous prenons notre exemple des crabes L. variegatus, nous avions travaillé un peu artificiellement sur une seule variable facteur en regroupant les variables species et sex en une seule variable group. Qu’en est-il si nous voulons quand même considérer les deux variables species et sex séparément ? c’est possible avec une ANOVA à deux facteurs. 11.1.1 Modèle sans interactions La version la plus simple consiste à considérer simplement deux facteurs successivement, c’est-à-dire que la variance est décomposée d’abord selon le premier facteur, et ensuite selon le second. \\[y_{ijk} = \\mu + \\tau1_j + \\tau2_k + \\epsilon_i \\mathrm{\\ avec\\ } \\epsilon \\sim N(0, \\sigma)\\] avec \\(\\tau1_j\\) correspondant à l’écart de la moyenne générale \\(µ\\) à la moyenne selon la jème population pour la variable fact1, et \\(\\tau2_k\\) correspondant à l’écart vers le kème niveau d’une seconde variable fact2. La formule qui spécifie ce modèle dans R avec les trois variables y, fact1 et fact2 s’écrit : \\[y \\sim fact1 + fact2\\] Notez que, quel que soit le niveau considéré pour \\(\\tau1\\), un niveau donné de \\(\\tau2\\) est constant dans l’équation qui décrit ce modèle. Cela signifie que l’on considère que les écarts pour les moyennes de la variable fact2 sont toujours les mêmes depuis les moyennes de fact1. Donc, si une sous-population de fact2 tend à avoir une moyenne, disons, supérieure pour la première sous-population de fact1, elle sera considérée comme ayant les mêmes écarts pour toutes les autres sous-populations de fact1. Evidemment, cette condition n’est pas toujours rencontrée dans la pratique. Le graphique des interactions (Fig. 11.1) permet de visualiser les écarts des moyennes respectives des différentes sous-populations. read(&quot;crabs&quot;, package = &quot;MASS&quot;, lang = &quot;fr&quot;) %&gt;.% mutate(., aspect = labelise( as.numeric(rear / width), &quot;Ratio largeur arrière / max&quot;, units = NA)) %&gt;.% mutate(., aspect5 = labelise( aspect^5, &quot;(Ratio largeur arrière /max)^5&quot;, units = NA)) %&gt;.% select(., species, sex, aspect, aspect5) -&gt; crabs2 # Graphique de base pour visualiser les interactions #chart$base(interaction.plot(crabs2$species, crabs2$sex, crabs2$aspect5)) # Version avec ggplot2 crabs2 %&gt;.% group_by(., species, sex) %&gt;.% summarise(., aspect5_groups = mean(aspect5)) %&gt;.% print(.) %&gt;.% # Tableau des moyennes par groupes chart(data = ., aspect5_groups ~ species %col=% sex %group=% sex) + geom_line() + geom_point() # # A tibble: 4 x 3 # # Groups: species [?] # species sex aspect5_groups # &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; # 1 B F 0.00727 # 2 B M 0.00363 # 3 O F 0.00811 # 4 O M 0.00427 Figure 11.1: Graphique des interactions entre les variables facteurs (espèce et sexe). Les traits (pratiquement) parallèles indiquent qu’il n’y a pas d’interactions, comme c’est le cas ici. Au niveau de la description préliminaire des données, nous pourrons utiliser un tableau qui résume la moyenne, l’écart type et le nombre d’observations pout chaque combinaison des deux variables facteurs. Le template de ce code est disponible dans un “snippet” à partir du menu hypothesis tests: means ou .hm, et ensuite two-way ANOVA (description). crabs2 %&gt;.% group_by(., species, sex) %&gt;.% summarise(., mean = mean(aspect5), sd = sd(aspect5), count = sum(!is.na(aspect5))) # # A tibble: 4 x 5 # # Groups: species [?] # species sex mean sd count # &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; # 1 B F 0.00727 0.00115 50 # 2 B M 0.00363 0.00124 50 # 3 O F 0.00811 0.00138 50 # 4 O M 0.00427 0.00130 50 Pour la visualisation graphique, nous sommes tributaires du nombre d’observations. Avec moins d’une petite dizaine d’observations, nous représenterons des points pour chaque observation et superposerons les moyennes. Lorsque le nombre est plus grand nous pourrons utiliser soit les boites de dispersion, soit le graphique en violon si ce nombre est encore plus grand. Voyons cela sur notre exemple (les “snippets” dans le menu chart: bivariate peuvent être utilisés comme point de départ auquel nous ajoutons la seconde variable facteur pour les facettes multi-graphiques séparée par un |). La Fig. 11.2 montre ce que cela donne si l’on opte pour les boites de dispersion. chart(data = crabs2, aspect5 ~ species | sex) + geom_boxplot() Figure 11.2: Taille relative de la carapace à l’arrière de crabes L. variegatus (deux variétés et deux sexes), version simple. La Fig. 11.3 est une version améliorée avec les observations et les moyennes pour chaque sous-groupe ajoutées au graphique selon la même technique que nous avions utilisé pour représenter les données pour l’ANOVA à un facteur. chart(data = crabs2, aspect5 ~ species | sex) + geom_boxplot() + geom_jitter(width = 0.05, alpha = 0.5) + geom_point(data = group_by(crabs2, species, sex) %&gt;.% summarise(., means = mean(aspect5, na.rm = TRUE)), f_aes(means ~ species), size = 3, col = &quot;red&quot;) Figure 11.3: Taille relative de la carapace à l’arrière de crabes L. variegatus (deux variétés et deux sexes), version annotée. Maintenant que nous avons décrit correctement nos données par rapport à l’analyse que nous souhaitons faire, nous pouvons réaliser notre ANOVA à deux facteurs. Nous devons vérifier l’homoscédasticité, mais le test de Batlett que nous réalisons revient au même que celui que nous avons fait en décomposant toutes les sous-populations. Comme nous n’avons pas nécessairement ce calcul réalisé (la variable group que nous avions calculée au module 10), nous utilisons la fonction interaction() qui effectue ce calcul pour nous directement dans la formule : bartlett.test(data = crabs2, aspect5 ~ interaction(species, sex)) # # Bartlett test of homogeneity of variances # # data: aspect5 by interaction(species, sex) # Bartlett&#39;s K-squared = 1.7948, df = 3, p-value = 0.6161 Si vous comparez avec le test que nous avions fait dans le cas de l’ANOVA à un facteur sur la variable group, vous constaterez qu’il donne exectement le même résultat. Nous continuons avec notre ANOVA. Nous avons un “snippet” pour cela dans le menu hypothesis tests: means à partir de .hm qui se nomme two-way ANOVA (without interactions). anova(anova. &lt;- lm(data = crabs2, aspect5 ~ species + sex)) # Analysis of Variance Table # # Response: aspect5 # Df Sum Sq Mean Sq F value Pr(&gt;F) # species 1 0.00002753 0.00002753 17.15 5.12e-05 *** # sex 1 0.00069935 0.00069935 435.66 &lt; 2.2e-16 *** # Residuals 197 0.00031624 0.00000161 # --- # Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Comme la variance est décomposée en trois étapes (selon l’espèce, puis selon le sexe, puis les résidus), nous avons trois lignes dans le tableau de l’ANOVA. Nous effectuons deux tests. Le premier consiste à comparer les carrés moyens (Mean Sq) pour l’espèce par rapport aux résidus. Donc, la valeur F est le ratio de la somme des carrés species divisé par la somme des carrés des résidus, et cette valeur est reportée sur la loi de distribution théorique F pour obtenir une première valeur P (ici 5,12 . 10-5). De même, le second test qui s’intéresse au sexe calcule la valeur F via la ratio de la somme des carrés pour sex divisé par la somme des carrés des résidus, et la loi F nous permet de calculer une seconde valeur P (ici 2,2 . 10-16). Nous interprétons chacun des deux tests séparément. Dans notre cas, nous pouvons dire avec un seuil \\(\\alpha\\) de 5% que nous rejettons \\(H_0\\) dans les deux cas. Donc le rapport largeur arrière sur largeur max de la carapace est significativement différent au seuil \\(\\alpha\\) de 5% à la fois en fonction de l’espèce (F = 17,15, ddl = 197 et 1, valeur P &lt;&lt; 0,001) et du sexe (F = 436, ddl = 197 et 1, valeur P &lt;&lt; 0,001)1. La suite logique consiste à réaliser des tests “post hoc”. Ils ne sont pas vraiment nécessaires ici puisque nous n’avons que deux niveaux pour chacune des deux variables, mais nous les réalisons quand même pour montrer le code correspondant. Un template est accessible via le “snippet” anova - multiple comparisons [multcomp] du menu .hm. Pensez juste à rajouter le second facteur sex dans les arguments de la fonction mcp(). summary(anovaComp. &lt;- confint(multcomp::glht(anova., linfct = multcomp::mcp(species = &quot;Tukey&quot;, sex = &quot;Tukey&quot;)))) # Add a second factor if you want # # Simultaneous Tests for General Linear Hypotheses # # Multiple Comparisons of Means: Tukey Contrasts # # # Fit: lm(formula = aspect5 ~ species + sex, data = crabs2) # # Linear Hypotheses: # Estimate Std. Error t value Pr(&gt;|t|) # species: O - B == 0 0.0007420 0.0001792 4.141 0.000102 *** # sex: M - F == 0 -0.0037399 0.0001792 -20.872 &lt; 1e-10 *** # --- # Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 # (Adjusted p values reported -- single-step method) .oma &lt;- par(oma = c(0, 5.1, 0, 0)); plot(anovaComp.); par(.oma); rm(.oma) Ceci confirme que les différences sont significatives au seuil \\(\\alpha\\) de 5%. Il ne nous reste plus qu’à vérifier la distribution des résidus de l’ANOVA pour que notre analyse soit complète (Fig. 11.4). Figure 11.4: Graphique quantile-quantile des résidus pour l’ANOVA à deux facteurs sans interactions de aspect^5. # [1] 65 103 Encore une fois, nous voyons que les résidus sont quasiment les mêmes que précédemment, mais cela n’aurait pas été le cas si une interaction existait. La distribution s’éloigne un peu d’une Gaussienne pour les valeurs élevées surtout. Mais comme l’ANOVA est robuste à ce critère, et que l’homoscédasticité a été vérifiée sur la tranformation puissance 5 de notre variable, nous pouvons conserver notre analyse moyennant une précaution supplémentaire : vérifier que les valeurs P sont beaucoup plus petites que notre seuil comme sécurité supplémentaires contre les approximations liées à la légère violation de la contrainte de distribution normale des résidus. C’est le cas ici, et nous pouvons donc conclure notre analyse. Conditions d’application échantillon représentatif (par exemple, aléatoire), observations indépendantes, variable réponse quantitative, deux variables explicatives qualitatives à deux niveaux ou plus, distribution normale des résidus \\(\\epsilon_i\\), homoscédasticité (même variance intragroupes), pas d’interactions entre les deux variables explicatives. 11.1.2 Modèle croisé complet Le modèle ANOVA que nous venons de faire s’appelle un modèle croisé parce que les mesures sont effectuées pour chaque combinaison des niveaux des deux variables facteurs explicatives, et ce, de manière indépendante (les observations d’un niveau ne sont pas dépendantes de celles d’un autre niveau)2. crabs2 %&gt;.% count(., species, sex) # # A tibble: 4 x 3 # species sex n # &lt;fct&gt; &lt;fct&gt; &lt;int&gt; # 1 B F 50 # 2 B M 50 # 3 O F 50 # 4 O M 50 Le modèle croisé sans interactions que nous avions utilisés est cependant incomplet puisque, pour considérer tous les cas possibles, il faut aussi considérer que ces interactions puissent exister et les inclure directement dans le modèle. Le modèle complet s’écrit comme ceci : \\[y_{ijk} = \\mu + \\tau1_j + \\tau2_k + \\tau1\\tau2_{jk} + \\epsilon_i \\mathrm{\\ avec\\ } \\epsilon \\sim N(0, \\sigma)\\] avec le nouveau terme \\(\\tau1\\tau2_{jk}\\) qui correspond à la distance entre la kème moyenne générale (la moyenne quel que soit j) et la moyenne particulière pour les observations des populations particulières à k et j simultanément. Ce modèle permet ainsi que chaque moyenne \\(\\bar{y}_{jk}\\) puisse différer librement, et donc, autorise les interactions. Toujours considérant les trois variables y, fact1 et fact2, ce modèle s’écrit dans R comme suit : \\[y \\sim fact1 + fact2 + fact1:fact2\\] Avec \\(fact1:fact2\\) étant le terme d’interactions. On peut aussi le simplifier en utilisant * à la place de + entre les deux variables facteurs, ce qui signifie implicitement de tenir également compte des interactions : \\[y \\sim fact1 * fact2\\] Cette fois-ci, la décomposition de la variable se fait en quatre étapes : (1) depuis la moyenne générale µ vers les jèmes moyennes pour fact1, ensuite (2) de ces moyennes vers les kèmes moyennes pour fact2, puis (3) de ces dernières vers la moyenne particulière pour le sous-groupe jk, et enfin (4) les résidus \\(\\epsilon_i\\) pour chaque observation. Voyons ce que donne ce modèle complet sur nos données crabs2. Un “snippets” est utilisable (two-way ANOVA (complete model)). anova(anova. &lt;- lm(data = crabs2, aspect5 ~ species * sex)) # Analysis of Variance Table # # Response: aspect5 # Df Sum Sq Mean Sq F value Pr(&gt;F) # species 1 0.00002753 0.00002753 17.0913 5.279e-05 *** # sex 1 0.00069935 0.00069935 434.1610 &lt; 2.2e-16 *** # species:sex 1 0.00000052 0.00000052 0.3236 0.5701 # Residuals 196 0.00031572 0.00000161 # --- # Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 Notre analyse confirme qu’il n’y a pas d’interactions. La valeur P (0,57) en regard du terme species:sex correspondant est très largement supérieure à \\(\\alpha\\) de 5%. Notez aussi que les tests relatifs à species et sex donnent des valeurs différentes de notre modèle sans interactions. Les différences entre les deux seront d’autant plus importantes que les interactions sont fortes. Les conclusions restent les mêmes que précédemment, et ici, nous démontrons par un test d’hypothèse que les interactions ne sont pas significatives. Naturellement, la description des données, les vérifications (homoscédasticité, distribution normale ou quasi-normale des résidus) et les analyses “post-hoc” en cas de rejet de \\(H_0\\) sont à réaliser ici aussi. Nous les avons déjà faites plus haut à peu de choses prêt (les résutats seront ici très proches de ceux du modèle sans interactions, puisque ces dernières sont négligeables). Faites attention à deux pièges fréquents. Le premier concerne les mesures multiples sur les mêmes individus. Par exemple, si vous étudiez trois populations avec disons, cinq répliquats par population et que vous dénombrez des cellules marquées sur dix coupes histologiques réalisées chaque fois dans un organe du même individu, vous aurez 3x5x10 = 150 mesures, mais vous ne pouvez pas utiliser une ANOVA à deux facteurs croisés car les 150 observations ne sont pas indépendantes les unes des autres. Vous n’avez jamais mesuré que 15 individus au total. Si vous analysez ces données comme si vous en aviez mesuré 150, votre analyse sera incorrecte. Il s’agit ici d’une erreur qui s’appelle la pseudo-réplication. Le second piège est en relation avec le premier. Avez-vous réellement besoin de deux facteurs ? Votre question porte sur la comparaison des trois populations. La comparaisons d’une lame à l’autre au sein de même individu n’est peut-être pas dans vos préoccupations (sinon, voyez le modèle imbriqué plus bas). Alors vous pouvez simplifier votre analyse en considérant la moyenne des 10 dénombrement comme mesure de départ (notée m10 par exemple) et faire une ANOVA à un seul facteur de cette variable en fonction des populations avec la formule m10 ~ pop. Notez que si vous incluez le tableau de l’ANOVA dans votre rapport ou dans une publication, il n’est pas nécessaire de répéter les résultats des tests entre parenthèses. Vous pouvez juste vous référer au tableau en question.↩ De plus, nous avons ici un plan balancé puisque le nombre de répliquats pour chaque niveau est le même. C’est une situation optimale qu’il faut toujours chercher à atteindre pour une ANOVA, même si un nombre différent d’observations par niveau est également accepté.↩ "]
]
